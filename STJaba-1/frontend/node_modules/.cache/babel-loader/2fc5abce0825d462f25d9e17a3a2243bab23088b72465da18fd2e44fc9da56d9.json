{"ast":null,"code":"var _jsxFileName = \"/Users/abdullahzayed/STJaba-1/frontend/src/components/MapDisplay.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function MapDisplay({\n  incidents = [],\n  vehicles = [],\n  selectedIncidentLocation,\n  selectedVehicleLocation,\n  onMapClick\n}) {\n  _s();\n  const mapRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  const markersRef = useRef({\n    incidents: {},\n    vehicles: {}\n  });\n  const routesRef = useRef([]);\n  const [routingActive, setRoutingActive] = useState(false);\n  const CENTER = [30.0635840, 31.4889939];\n  const ZOOM = 15;\n\n  // Convert normalized coords to lat/lng\n  const normToLatLng = norm => {\n    if (!norm || norm.x === undefined || norm.y === undefined) return null;\n    const latOffset = (0.5 - norm.y) * 0.1;\n    const lngOffset = (norm.x - 0.5) * 0.1;\n    return [CENTER[0] + latOffset, CENTER[1] + lngOffset];\n  };\n\n  // Convert lat/lng to normalized coords\n  const latLngToNorm = (lat, lng) => {\n    const latOffset = lat - CENTER[0];\n    const lngOffset = lng - CENTER[1];\n    const x = 0.5 + lngOffset / 0.1;\n    const y = 0.5 - latOffset / 0.1;\n    return {\n      x: parseFloat(Math.max(0, Math.min(1, x)).toFixed(4)),\n      y: parseFloat(Math.max(0, Math.min(1, y)).toFixed(4))\n    };\n  };\n\n  // Custom icon for incidents (red warning triangle with centered exclamation mark)\n  const createIncidentIcon = () => {\n    if (!window.L) return null;\n    return window.L.divIcon({\n      html: `\n        <div style=\"\n          position: relative;\n          width: 24px;\n          height: 24px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        \">\n          <div style=\"\n            width: 0;\n            height: 0;\n            border-left: 12px solid transparent;\n            border-right: 12px solid transparent;\n            border-bottom: 20px solid #dc2626;\n            position: absolute;\n            top: 0;\n            left: 0;\n            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));\n          \"></div>\n          <div style=\"\n            position: absolute;\n            top: 3px;\n            color: white;\n            font-size: 14px;\n            font-weight: bold;\n            text-align: center;\n            width: 24px;\n            left: 0;\n          \">\n            !\n          </div>\n        </div>\n      `,\n      className: 'incident-icon',\n      iconSize: [24, 24],\n      iconAnchor: [12, 24]\n    });\n  };\n\n  // Custom icon for vehicles (car icon)\n  const createVehicleIcon = () => {\n    if (!window.L) return null;\n    return window.L.divIcon({\n      html: `\n        <div style=\"\n          position: relative;\n          width: 24px;\n          height: 24px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        \">\n          <div style=\"\n            width: 22px;\n            height: 22px;\n            background: #3b82f6;\n            border-radius: 50%;\n            border: 2px solid white;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n          \">\n            <div style=\"\n              color: white;\n              font-size: 12px;\n              font-weight: bold;\n              transform: translateY(0px);\n            \">\n              üöó\n            </div>\n          </div>\n        </div>\n      `,\n      className: 'vehicle-icon',\n      iconSize: [24, 24],\n      iconAnchor: [12, 12]\n    });\n  };\n\n  // Draw route from vehicle to incident using OSRM API\n  const drawRoute = (fromLatLng, toLatLng, color = '#3b82f6', vehicleName = '') => {\n    if (!window.L || !mapInstanceRef.current) return null;\n    const L = window.L;\n    const map = mapInstanceRef.current;\n\n    // OSRM API endpoint for routing\n    const osrmUrl = `https://router.project-osrm.org/route/v1/driving/${fromLatLng[1]},${fromLatLng[0]};${toLatLng[1]},${toLatLng[0]}?overview=full&geometries=geojson`;\n    let routeLine = null;\n    let distanceLabel = null;\n    fetch(osrmUrl).then(response => response.json()).then(data => {\n      if (data.code === 'Ok') {\n        const route = data.routes[0];\n        const routeCoordinates = route.geometry.coordinates.map(coord => [coord[1], coord[0]]);\n\n        // Create a polyline for the route\n        routeLine = L.polyline(routeCoordinates, {\n          color: color,\n          weight: 4,\n          opacity: 0.7,\n          dashArray: '10, 10',\n          lineCap: 'round'\n        }).addTo(map);\n\n        // Add distance and duration info\n        const distanceKm = (route.distance / 1000).toFixed(2);\n        const durationMinutes = Math.ceil(route.duration / 60);\n\n        // Add a popup at the start of the route\n        distanceLabel = L.marker(fromLatLng, {\n          icon: L.divIcon({\n            html: `\n                <div style=\"\n                  background: white;\n                  border: 2px solid ${color};\n                  border-radius: 4px;\n                  padding: 2px 6px;\n                  font-size: 11px;\n                  font-weight: bold;\n                  color: ${color};\n                  box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n                \">\n                  ${distanceKm} km\n                </div>\n              `,\n            className: 'route-label',\n            iconSize: [60, 20],\n            iconAnchor: [30, 10]\n          })\n        }).addTo(map);\n\n        // Store route for cleanup\n        routesRef.current.push({\n          route: routeLine,\n          label: distanceLabel\n        });\n        console.log(`Route from vehicle to incident: ${distanceKm} km, ${durationMinutes} min`);\n      } else {\n        console.warn('No route found between points');\n        // Draw a straight line if no route found\n        routeLine = L.polyline([fromLatLng, toLatLng], {\n          color: '#94a3b8',\n          weight: 2,\n          opacity: 0.5,\n          dashArray: '5, 5'\n        }).addTo(map);\n        routesRef.current.push({\n          route: routeLine,\n          label: null\n        });\n      }\n    }).catch(error => {\n      console.error('Error fetching route:', error);\n      // Draw a straight line as fallback\n      routeLine = L.polyline([fromLatLng, toLatLng], {\n        color: '#94a3b8',\n        weight: 2,\n        opacity: 0.5,\n        dashArray: '5, 5'\n      }).addTo(map);\n      routesRef.current.push({\n        route: routeLine,\n        label: null\n      });\n    });\n  };\n\n  // Clear all routes\n  const clearRoutes = () => {\n    routesRef.current.forEach(routeItem => {\n      if (routeItem.route && routeItem.route.remove) routeItem.route.remove();\n      if (routeItem.label && routeItem.label.remove) routeItem.label.remove();\n    });\n    routesRef.current = [];\n  };\n\n  // Draw routes from all vehicles to all pending incidents\n  const drawAllRoutes = () => {\n    if (!routingActive) return;\n    const pendingIncidents = incidents.filter(i => i.status === 'pending');\n    pendingIncidents.forEach(incident => {\n      const incidentLatLng = normToLatLng(incident.location);\n      if (!incidentLatLng) return;\n      vehicles.forEach(vehicle => {\n        const vehicleLatLng = normToLatLng(vehicle.location);\n        if (!vehicleLatLng) return;\n\n        // Use different colors for different vehicles\n        const colors = ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'];\n        const color = colors[vehicle.id % colors.length];\n        drawRoute(vehicleLatLng, incidentLatLng, color, vehicle.name);\n      });\n    });\n  };\n\n  // Draw route from selected vehicle to selected incident\n  const drawSelectedRoute = () => {\n    if (!selectedVehicleLocation || !selectedIncidentLocation) return;\n    const vehicleLatLng = normToLatLng(selectedVehicleLocation);\n    const incidentLatLng = normToLatLng(selectedIncidentLocation);\n    if (vehicleLatLng && incidentLatLng) {\n      drawRoute(vehicleLatLng, incidentLatLng, '#10b981', 'Selected');\n    }\n  };\n\n  // Reset map to default view\n  const resetMap = () => {\n    if (mapInstanceRef.current) {\n      mapInstanceRef.current.setView(CENTER, ZOOM);\n      // Clear all routes and reset routing state\n      clearRoutes();\n      setRoutingActive(false);\n      console.log('Map reset to default view');\n    }\n  };\n\n  // Initialize map\n  useEffect(() => {\n    // Check if Leaflet is already loaded\n    if (window.L && window.L.map) {\n      initMap();\n    } else {\n      // Load Leaflet CSS\n      if (!document.querySelector('link[href*=\"leaflet\"]')) {\n        const link = document.createElement('link');\n        link.rel = 'stylesheet';\n        link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';\n        link.integrity = 'sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=';\n        link.crossOrigin = '';\n        document.head.appendChild(link);\n      }\n\n      // Load Leaflet JS\n      if (!window.L) {\n        const script = document.createElement('script');\n        script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';\n        script.integrity = 'sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=';\n        script.crossOrigin = '';\n        script.onload = () => {\n          console.log('Leaflet loaded successfully');\n          initMap();\n        };\n        script.onerror = () => {\n          console.error('Failed to load Leaflet');\n        };\n        document.head.appendChild(script);\n      }\n    }\n    function initMap() {\n      if (!mapRef.current || mapInstanceRef.current) return;\n      try {\n        const L = window.L;\n        const map = L.map(mapRef.current).setView(CENTER, ZOOM);\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n          attribution: '¬© OpenStreetMap contributors | Routing: OSRM',\n          maxZoom: 19\n        }).addTo(map);\n\n        // Click handler\n        map.on('click', e => {\n          const norm = latLngToNorm(e.latlng.lat, e.latlng.lng);\n          if (onMapClick) {\n            onMapClick(norm);\n          }\n        });\n        mapInstanceRef.current = map;\n        console.log('Map initialized successfully');\n\n        // Force update markers after map is ready\n        setTimeout(() => {\n          updateMarkers();\n        }, 100);\n      } catch (error) {\n        console.error('Error initializing map:', error);\n      }\n    }\n    return () => {\n      clearRoutes();\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove();\n        mapInstanceRef.current = null;\n      }\n    };\n  }, [onMapClick]);\n\n  // Update markers function\n  const updateMarkers = () => {\n    if (!mapInstanceRef.current || !window.L) {\n      console.log('Map not ready for markers');\n      return;\n    }\n    const L = window.L;\n    const map = mapInstanceRef.current;\n    const markers = markersRef.current;\n\n    // Clear old markers\n    Object.values(markers.incidents).forEach(m => {\n      if (m && m.remove) m.remove();\n    });\n    Object.values(markers.vehicles).forEach(m => {\n      if (m && m.remove) m.remove();\n    });\n    markers.incidents = {};\n    markers.vehicles = {};\n\n    // Add pending incidents as red triangles\n    const incidentIcon = createIncidentIcon();\n    incidents.filter(i => i.status === 'pending').forEach(inc => {\n      const pos = normToLatLng(inc.location);\n      if (pos && incidentIcon) {\n        const marker = L.marker(pos, {\n          icon: incidentIcon\n        }).addTo(map);\n        marker.bindPopup(`\n          <div style=\"font-weight: bold; color: #dc2626; margin-bottom: 5px;\">\n            üö® Incident: ${inc.name}\n          </div>\n          <div style=\"margin-bottom: 3px;\">\n            <strong>Status:</strong> <span style=\"color: #dc2626;\">${inc.status}</span>\n          </div>\n          <div style=\"font-size: 11px; color: #666;\">\n            Coordinates: ${inc.location.x.toFixed(3)}, ${inc.location.y.toFixed(3)}\n          </div>\n        `);\n        markers.incidents[inc.id] = marker;\n      }\n    });\n\n    // Add vehicles as car icons\n    const vehicleIcon = createVehicleIcon();\n    vehicles.forEach(veh => {\n      const pos = normToLatLng(veh.location);\n      if (pos && vehicleIcon) {\n        const marker = L.marker(pos, {\n          icon: vehicleIcon\n        }).addTo(map);\n        marker.bindPopup(`\n          <div style=\"font-weight: bold; color: #3b82f6; margin-bottom: 5px;\">\n            üöó Vehicle: ${veh.name}\n          </div>\n          <div style=\"font-size: 11px; color: #666;\">\n            Coordinates: ${veh.location.x.toFixed(3)}, ${veh.location.y.toFixed(3)}\n          </div>\n        `);\n        markers.vehicles[veh.id] = marker;\n      }\n    });\n\n    // Add selected locations\n    if (selectedIncidentLocation) {\n      const pos = normToLatLng(selectedIncidentLocation);\n      if (pos) {\n        L.circleMarker(pos, {\n          radius: 8,\n          fillColor: '#10b981',\n          color: '#065f46',\n          weight: 3,\n          fillOpacity: 0.7\n        }).addTo(map).bindPopup(`\n          <div style=\"font-weight: bold; color: #10b981;\">\n            üìç Selected Incident Location\n          </div>\n          <div style=\"font-size: 11px;\">\n            Coordinates: ${selectedIncidentLocation.x.toFixed(3)}, ${selectedIncidentLocation.y.toFixed(3)}\n          </div>\n        `);\n      }\n    }\n    if (selectedVehicleLocation) {\n      const pos = normToLatLng(selectedVehicleLocation);\n      if (pos) {\n        L.circleMarker(pos, {\n          radius: 8,\n          fillColor: '#8b5cf6',\n          color: '#5b21b6',\n          weight: 3,\n          fillOpacity: 0.7\n        }).addTo(map).bindPopup(`\n          <div style=\"font-weight: bold; color: #8b5cf6;\">\n            üìç Selected Vehicle Location\n          </div>\n          <div style=\"font-size: 11px;\">\n            Coordinates: ${selectedVehicleLocation.x.toFixed(3)}, ${selectedVehicleLocation.y.toFixed(3)}\n          </div>\n        `);\n      }\n    }\n\n    // Clear existing routes before drawing new ones\n    clearRoutes();\n\n    // Draw routes if routing is active OR if we have selected locations\n    if (routingActive) {\n      drawAllRoutes();\n    } else if (selectedVehicleLocation && selectedIncidentLocation) {\n      drawSelectedRoute();\n    }\n  };\n\n  // Toggle routing - this should only control ALL routes, not selected route\n  const toggleRouting = () => {\n    const newRoutingActive = !routingActive;\n    setRoutingActive(newRoutingActive);\n\n    // Clear all routes when toggling off\n    if (!newRoutingActive) {\n      clearRoutes();\n    }\n  };\n\n  // Update markers when data changes or when routingActive changes\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L) {\n      updateMarkers();\n    }\n  }, [incidents, vehicles, selectedIncidentLocation, selectedVehicleLocation, routingActive]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"map-container panel\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mapRef,\n      style: {\n        width: '100%',\n        height: '520px',\n        minHeight: '520px'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 471,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        padding: '8px',\n        background: '#f8fafc',\n        borderTop: '1px solid #e2e8f0',\n        fontSize: '12px',\n        color: '#64748b'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          gap: '8px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: toggleRouting,\n          style: {\n            padding: '4px 12px',\n            background: routingActive ? '#ef4444' : '#10b981',\n            color: 'white',\n            border: 'none',\n            borderRadius: '4px',\n            cursor: 'pointer',\n            fontSize: '12px',\n            fontWeight: 'bold'\n          },\n          children: routingActive ? '‚ùå Hide All Routes' : 'üîÑ Show All Routes'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 490,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: resetMap,\n          style: {\n            padding: '4px 12px',\n            background: '#6b7280',\n            color: 'white',\n            border: 'none',\n            borderRadius: '4px',\n            cursor: 'pointer',\n            fontSize: '12px',\n            fontWeight: 'bold',\n            display: 'flex',\n            alignItems: 'center',\n            gap: '4px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"\\uD83D\\uDDFA\\uFE0F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 522,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Reset Map\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 523,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 506,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontStyle: 'italic',\n            marginLeft: '8px'\n          },\n          children: routingActive ? 'Showing routes from all vehicles to all incidents' : selectedVehicleLocation && selectedIncidentLocation ? 'Showing route between selected locations' : 'Click map to select locations'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 526,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 489,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: '11px',\n          color: '#94a3b8'\n        },\n        children: [\"Routing: OSRM | \\uD83D\\uDE97 Vehicles: \", vehicles.length, \" | \\uD83D\\uDEA8 Incidents: \", incidents.filter(i => i.status === 'pending').length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 535,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 479,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 470,\n    columnNumber: 5\n  }, this);\n}\n_s(MapDisplay, \"pEnHjiq2ISUvTtxfwcEd0alHUAg=\");\n_c = MapDisplay;\nvar _c;\n$RefreshReg$(_c, \"MapDisplay\");","map":{"version":3,"names":["React","useEffect","useRef","useState","jsxDEV","_jsxDEV","MapDisplay","incidents","vehicles","selectedIncidentLocation","selectedVehicleLocation","onMapClick","_s","mapRef","mapInstanceRef","markersRef","routesRef","routingActive","setRoutingActive","CENTER","ZOOM","normToLatLng","norm","x","undefined","y","latOffset","lngOffset","latLngToNorm","lat","lng","parseFloat","Math","max","min","toFixed","createIncidentIcon","window","L","divIcon","html","className","iconSize","iconAnchor","createVehicleIcon","drawRoute","fromLatLng","toLatLng","color","vehicleName","current","map","osrmUrl","routeLine","distanceLabel","fetch","then","response","json","data","code","route","routes","routeCoordinates","geometry","coordinates","coord","polyline","weight","opacity","dashArray","lineCap","addTo","distanceKm","distance","durationMinutes","ceil","duration","marker","icon","push","label","console","log","warn","catch","error","clearRoutes","forEach","routeItem","remove","drawAllRoutes","pendingIncidents","filter","i","status","incident","incidentLatLng","location","vehicle","vehicleLatLng","colors","id","length","name","drawSelectedRoute","resetMap","setView","initMap","document","querySelector","link","createElement","rel","href","integrity","crossOrigin","head","appendChild","script","src","onload","onerror","tileLayer","attribution","maxZoom","on","e","latlng","setTimeout","updateMarkers","markers","Object","values","m","incidentIcon","inc","pos","bindPopup","vehicleIcon","veh","circleMarker","radius","fillColor","fillOpacity","toggleRouting","newRoutingActive","children","ref","style","width","height","minHeight","fileName","_jsxFileName","lineNumber","columnNumber","display","justifyContent","alignItems","padding","background","borderTop","fontSize","gap","onClick","border","borderRadius","cursor","fontWeight","fontStyle","marginLeft","_c","$RefreshReg$"],"sources":["/Users/abdullahzayed/STJaba-1/frontend/src/components/MapDisplay.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react'\n\nexport default function MapDisplay({ \n  incidents = [], \n  vehicles = [], \n  selectedIncidentLocation, \n  selectedVehicleLocation, \n  onMapClick \n}) {\n  const mapRef = useRef(null)\n  const mapInstanceRef = useRef(null)\n  const markersRef = useRef({ incidents: {}, vehicles: {} })\n  const routesRef = useRef([])\n  const [routingActive, setRoutingActive] = useState(false)\n\n  const CENTER = [30.0635840, 31.4889939]\n  const ZOOM = 15\n\n  // Convert normalized coords to lat/lng\n  const normToLatLng = (norm) => {\n    if (!norm || norm.x === undefined || norm.y === undefined) return null\n    const latOffset = (0.5 - norm.y) * 0.1\n    const lngOffset = (norm.x - 0.5) * 0.1\n    return [CENTER[0] + latOffset, CENTER[1] + lngOffset]\n  }\n\n  // Convert lat/lng to normalized coords\n  const latLngToNorm = (lat, lng) => {\n    const latOffset = lat - CENTER[0]\n    const lngOffset = lng - CENTER[1]\n    const x = 0.5 + (lngOffset / 0.1)\n    const y = 0.5 - (latOffset / 0.1)\n    return { \n      x: parseFloat(Math.max(0, Math.min(1, x)).toFixed(4)), \n      y: parseFloat(Math.max(0, Math.min(1, y)).toFixed(4)) \n    }\n  }\n\n  // Custom icon for incidents (red warning triangle with centered exclamation mark)\n  const createIncidentIcon = () => {\n    if (!window.L) return null\n    return window.L.divIcon({\n      html: `\n        <div style=\"\n          position: relative;\n          width: 24px;\n          height: 24px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        \">\n          <div style=\"\n            width: 0;\n            height: 0;\n            border-left: 12px solid transparent;\n            border-right: 12px solid transparent;\n            border-bottom: 20px solid #dc2626;\n            position: absolute;\n            top: 0;\n            left: 0;\n            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));\n          \"></div>\n          <div style=\"\n            position: absolute;\n            top: 3px;\n            color: white;\n            font-size: 14px;\n            font-weight: bold;\n            text-align: center;\n            width: 24px;\n            left: 0;\n          \">\n            !\n          </div>\n        </div>\n      `,\n      className: 'incident-icon',\n      iconSize: [24, 24],\n      iconAnchor: [12, 24]\n    })\n  }\n\n  // Custom icon for vehicles (car icon)\n  const createVehicleIcon = () => {\n    if (!window.L) return null\n    return window.L.divIcon({\n      html: `\n        <div style=\"\n          position: relative;\n          width: 24px;\n          height: 24px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        \">\n          <div style=\"\n            width: 22px;\n            height: 22px;\n            background: #3b82f6;\n            border-radius: 50%;\n            border: 2px solid white;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n          \">\n            <div style=\"\n              color: white;\n              font-size: 12px;\n              font-weight: bold;\n              transform: translateY(0px);\n            \">\n              üöó\n            </div>\n          </div>\n        </div>\n      `,\n      className: 'vehicle-icon',\n      iconSize: [24, 24],\n      iconAnchor: [12, 12]\n    })\n  }\n\n  // Draw route from vehicle to incident using OSRM API\n  const drawRoute = (fromLatLng, toLatLng, color = '#3b82f6', vehicleName = '') => {\n    if (!window.L || !mapInstanceRef.current) return null\n    \n    const L = window.L\n    const map = mapInstanceRef.current\n    \n    // OSRM API endpoint for routing\n    const osrmUrl = `https://router.project-osrm.org/route/v1/driving/${fromLatLng[1]},${fromLatLng[0]};${toLatLng[1]},${toLatLng[0]}?overview=full&geometries=geojson`\n    \n    let routeLine = null\n    let distanceLabel = null\n    \n    fetch(osrmUrl)\n      .then(response => response.json())\n      .then(data => {\n        if (data.code === 'Ok') {\n          const route = data.routes[0]\n          const routeCoordinates = route.geometry.coordinates.map(coord => [coord[1], coord[0]])\n          \n          // Create a polyline for the route\n          routeLine = L.polyline(routeCoordinates, {\n            color: color,\n            weight: 4,\n            opacity: 0.7,\n            dashArray: '10, 10',\n            lineCap: 'round'\n          }).addTo(map)\n          \n          // Add distance and duration info\n          const distanceKm = (route.distance / 1000).toFixed(2)\n          const durationMinutes = Math.ceil(route.duration / 60)\n          \n          // Add a popup at the start of the route\n          distanceLabel = L.marker(fromLatLng, {\n            icon: L.divIcon({\n              html: `\n                <div style=\"\n                  background: white;\n                  border: 2px solid ${color};\n                  border-radius: 4px;\n                  padding: 2px 6px;\n                  font-size: 11px;\n                  font-weight: bold;\n                  color: ${color};\n                  box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n                \">\n                  ${distanceKm} km\n                </div>\n              `,\n              className: 'route-label',\n              iconSize: [60, 20],\n              iconAnchor: [30, 10]\n            })\n          }).addTo(map)\n          \n          // Store route for cleanup\n          routesRef.current.push({ route: routeLine, label: distanceLabel })\n          \n          console.log(`Route from vehicle to incident: ${distanceKm} km, ${durationMinutes} min`)\n        } else {\n          console.warn('No route found between points')\n          // Draw a straight line if no route found\n          routeLine = L.polyline([fromLatLng, toLatLng], {\n            color: '#94a3b8',\n            weight: 2,\n            opacity: 0.5,\n            dashArray: '5, 5'\n          }).addTo(map)\n          routesRef.current.push({ route: routeLine, label: null })\n        }\n      })\n      .catch(error => {\n        console.error('Error fetching route:', error)\n        // Draw a straight line as fallback\n        routeLine = L.polyline([fromLatLng, toLatLng], {\n          color: '#94a3b8',\n          weight: 2,\n          opacity: 0.5,\n          dashArray: '5, 5'\n        }).addTo(map)\n        routesRef.current.push({ route: routeLine, label: null })\n      })\n  }\n\n  // Clear all routes\n  const clearRoutes = () => {\n    routesRef.current.forEach(routeItem => {\n      if (routeItem.route && routeItem.route.remove) routeItem.route.remove()\n      if (routeItem.label && routeItem.label.remove) routeItem.label.remove()\n    })\n    routesRef.current = []\n  }\n\n  // Draw routes from all vehicles to all pending incidents\n  const drawAllRoutes = () => {\n    if (!routingActive) return\n    \n    const pendingIncidents = incidents.filter(i => i.status === 'pending')\n    \n    pendingIncidents.forEach(incident => {\n      const incidentLatLng = normToLatLng(incident.location)\n      if (!incidentLatLng) return\n      \n      vehicles.forEach(vehicle => {\n        const vehicleLatLng = normToLatLng(vehicle.location)\n        if (!vehicleLatLng) return\n        \n        // Use different colors for different vehicles\n        const colors = ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444']\n        const color = colors[vehicle.id % colors.length]\n        \n        drawRoute(vehicleLatLng, incidentLatLng, color, vehicle.name)\n      })\n    })\n  }\n\n  // Draw route from selected vehicle to selected incident\n  const drawSelectedRoute = () => {\n    if (!selectedVehicleLocation || !selectedIncidentLocation) return\n    \n    const vehicleLatLng = normToLatLng(selectedVehicleLocation)\n    const incidentLatLng = normToLatLng(selectedIncidentLocation)\n    \n    if (vehicleLatLng && incidentLatLng) {\n      drawRoute(vehicleLatLng, incidentLatLng, '#10b981', 'Selected')\n    }\n  }\n\n  // Reset map to default view\n  const resetMap = () => {\n    if (mapInstanceRef.current) {\n      mapInstanceRef.current.setView(CENTER, ZOOM)\n      // Clear all routes and reset routing state\n      clearRoutes()\n      setRoutingActive(false)\n      console.log('Map reset to default view')\n    }\n  }\n\n  // Initialize map\n  useEffect(() => {\n    // Check if Leaflet is already loaded\n    if (window.L && window.L.map) {\n      initMap()\n    } else {\n      // Load Leaflet CSS\n      if (!document.querySelector('link[href*=\"leaflet\"]')) {\n        const link = document.createElement('link')\n        link.rel = 'stylesheet'\n        link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css'\n        link.integrity = 'sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY='\n        link.crossOrigin = ''\n        document.head.appendChild(link)\n      }\n\n      // Load Leaflet JS\n      if (!window.L) {\n        const script = document.createElement('script')\n        script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js'\n        script.integrity = 'sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo='\n        script.crossOrigin = ''\n        script.onload = () => {\n          console.log('Leaflet loaded successfully')\n          initMap()\n        }\n        script.onerror = () => {\n          console.error('Failed to load Leaflet')\n        }\n        document.head.appendChild(script)\n      }\n    }\n\n    function initMap() {\n      if (!mapRef.current || mapInstanceRef.current) return\n      \n      try {\n        const L = window.L\n        const map = L.map(mapRef.current).setView(CENTER, ZOOM)\n        \n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n          attribution: '¬© OpenStreetMap contributors | Routing: OSRM',\n          maxZoom: 19\n        }).addTo(map)\n\n        // Click handler\n        map.on('click', (e) => {\n          const norm = latLngToNorm(e.latlng.lat, e.latlng.lng)\n          if (onMapClick) {\n            onMapClick(norm)\n          }\n        })\n\n        mapInstanceRef.current = map\n        console.log('Map initialized successfully')\n        \n        // Force update markers after map is ready\n        setTimeout(() => {\n          updateMarkers()\n        }, 100)\n        \n      } catch (error) {\n        console.error('Error initializing map:', error)\n      }\n    }\n\n    return () => {\n      clearRoutes()\n      if (mapInstanceRef.current) {\n        mapInstanceRef.current.remove()\n        mapInstanceRef.current = null\n      }\n    }\n  }, [onMapClick])\n\n  // Update markers function\n  const updateMarkers = () => {\n    if (!mapInstanceRef.current || !window.L) {\n      console.log('Map not ready for markers')\n      return\n    }\n\n    const L = window.L\n    const map = mapInstanceRef.current\n    const markers = markersRef.current\n\n    // Clear old markers\n    Object.values(markers.incidents).forEach(m => {\n      if (m && m.remove) m.remove()\n    })\n    Object.values(markers.vehicles).forEach(m => {\n      if (m && m.remove) m.remove()\n    })\n    markers.incidents = {}\n    markers.vehicles = {}\n\n    // Add pending incidents as red triangles\n    const incidentIcon = createIncidentIcon()\n    incidents.filter(i => i.status === 'pending').forEach(inc => {\n      const pos = normToLatLng(inc.location)\n      if (pos && incidentIcon) {\n        const marker = L.marker(pos, { icon: incidentIcon }).addTo(map)\n        marker.bindPopup(`\n          <div style=\"font-weight: bold; color: #dc2626; margin-bottom: 5px;\">\n            üö® Incident: ${inc.name}\n          </div>\n          <div style=\"margin-bottom: 3px;\">\n            <strong>Status:</strong> <span style=\"color: #dc2626;\">${inc.status}</span>\n          </div>\n          <div style=\"font-size: 11px; color: #666;\">\n            Coordinates: ${inc.location.x.toFixed(3)}, ${inc.location.y.toFixed(3)}\n          </div>\n        `)\n        markers.incidents[inc.id] = marker\n      }\n    })\n\n    // Add vehicles as car icons\n    const vehicleIcon = createVehicleIcon()\n    vehicles.forEach(veh => {\n      const pos = normToLatLng(veh.location)\n      if (pos && vehicleIcon) {\n        const marker = L.marker(pos, { icon: vehicleIcon }).addTo(map)\n        marker.bindPopup(`\n          <div style=\"font-weight: bold; color: #3b82f6; margin-bottom: 5px;\">\n            üöó Vehicle: ${veh.name}\n          </div>\n          <div style=\"font-size: 11px; color: #666;\">\n            Coordinates: ${veh.location.x.toFixed(3)}, ${veh.location.y.toFixed(3)}\n          </div>\n        `)\n        markers.vehicles[veh.id] = marker\n      }\n    })\n\n    // Add selected locations\n    if (selectedIncidentLocation) {\n      const pos = normToLatLng(selectedIncidentLocation)\n      if (pos) {\n        L.circleMarker(pos, {\n          radius: 8,\n          fillColor: '#10b981',\n          color: '#065f46',\n          weight: 3,\n          fillOpacity: 0.7\n        }).addTo(map).bindPopup(`\n          <div style=\"font-weight: bold; color: #10b981;\">\n            üìç Selected Incident Location\n          </div>\n          <div style=\"font-size: 11px;\">\n            Coordinates: ${selectedIncidentLocation.x.toFixed(3)}, ${selectedIncidentLocation.y.toFixed(3)}\n          </div>\n        `)\n      }\n    }\n\n    if (selectedVehicleLocation) {\n      const pos = normToLatLng(selectedVehicleLocation)\n      if (pos) {\n        L.circleMarker(pos, {\n          radius: 8,\n          fillColor: '#8b5cf6',\n          color: '#5b21b6',\n          weight: 3,\n          fillOpacity: 0.7\n        }).addTo(map).bindPopup(`\n          <div style=\"font-weight: bold; color: #8b5cf6;\">\n            üìç Selected Vehicle Location\n          </div>\n          <div style=\"font-size: 11px;\">\n            Coordinates: ${selectedVehicleLocation.x.toFixed(3)}, ${selectedVehicleLocation.y.toFixed(3)}\n          </div>\n        `)\n      }\n    }\n\n    // Clear existing routes before drawing new ones\n    clearRoutes()\n\n    // Draw routes if routing is active OR if we have selected locations\n    if (routingActive) {\n      drawAllRoutes()\n    } else if (selectedVehicleLocation && selectedIncidentLocation) {\n      drawSelectedRoute()\n    }\n  }\n\n  // Toggle routing - this should only control ALL routes, not selected route\n  const toggleRouting = () => {\n    const newRoutingActive = !routingActive\n    setRoutingActive(newRoutingActive)\n    \n    // Clear all routes when toggling off\n    if (!newRoutingActive) {\n      clearRoutes()\n    }\n  }\n\n  // Update markers when data changes or when routingActive changes\n  useEffect(() => {\n    if (mapInstanceRef.current && window.L) {\n      updateMarkers()\n    }\n  }, [incidents, vehicles, selectedIncidentLocation, selectedVehicleLocation, routingActive])\n\n  return (\n    <div className=\"map-container panel\">\n      <div \n        ref={mapRef} \n        style={{ \n          width: '100%', \n          height: '520px',\n          minHeight: '520px'\n        }}\n      />\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        padding: '8px',\n        background: '#f8fafc',\n        borderTop: '1px solid #e2e8f0',\n        fontSize: '12px',\n        color: '#64748b'\n      }}>\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\n          <button \n            onClick={toggleRouting}\n            style={{\n              padding: '4px 12px',\n              background: routingActive ? '#ef4444' : '#10b981',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: 'pointer',\n              fontSize: '12px',\n              fontWeight: 'bold',\n            }}\n          >\n            {routingActive ? '‚ùå Hide All Routes' : 'üîÑ Show All Routes'}\n          </button>\n          \n          <button \n            onClick={resetMap}\n            style={{\n              padding: '4px 12px',\n              background: '#6b7280',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: 'pointer',\n              fontSize: '12px',\n              fontWeight: 'bold',\n              display: 'flex',\n              alignItems: 'center',\n              gap: '4px'\n            }}\n          >\n            <span>üó∫Ô∏è</span>\n            <span>Reset Map</span>\n          </button>\n          \n          <span style={{ fontStyle: 'italic', marginLeft: '8px' }}>\n            {routingActive \n              ? 'Showing routes from all vehicles to all incidents' \n              : selectedVehicleLocation && selectedIncidentLocation\n                ? 'Showing route between selected locations'\n                : 'Click map to select locations'\n            }\n          </span>\n        </div>\n        <div style={{ fontSize: '11px', color: '#94a3b8' }}>\n          Routing: OSRM | üöó Vehicles: {vehicles.length} | üö® Incidents: {incidents.filter(i => i.status === 'pending').length}\n        </div>\n      </div>\n    </div>\n  )\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}